Please perform a refactor on "server/ai/ragQuery.ts" and "server/ai/advisor.ts" to improve code quality, remove redundancy, and fix fragile regex logic.

Here is the plan:

1. REFACTOR `server/ai/ragQuery.ts`:
   - Import `storage` from `../storage` (ensure correct path).
   - In `retrieveKnowledgeChunks`, REMOVE the raw `db.execute(sql...)` block.
   - Instead, use `await storage.searchKnowledgeChunks(queryEmbedding, topK)`.
   - Map the result from storage to the `RetrievedChunk` interface (note: storage returns `similarity` instead of `score`, and `source.fileName` instead of `doc_name`).

2. REFACTOR `server/ai/advisor.ts`:
   - Remove the `cleanRecommendationText` function and all its regex logic completely.
   - Import `zod` from "zod".
   - Update `generateAIInsights` to use OpenAI Structured Outputs (JSON mode) instead of plain text generation.
     - Define a Zod schema for the insight: `z.object({ analysis: z.string(), keyImprovement: z.string(), marketComparison: z.string(), practicalTip: z.string() })`.
     - Use `openai.chat.completions.parse` (or `response_format: { type: "json_object" }` if parse is unavailable) to get this JSON.
     - Construct the final return string from this JSON so it is clean and follows the format: "{analysis}\n\n**Wichtigste Verbesserung:** {keyImprovement}\n**Marktvergleich:** {marketComparison}\n**Praxis-Tipp:** {practicalTip}".
   - Update `getQuickRecommendation` similarly to use JSON mode:
     - Schema: `z.object({ recommendation: z.string(), reasoning: z.string() })`.
     - Return only the `recommendation` string to keep backward compatibility.
   - Update `analyzeLayout` to remove calls to `cleanRecommendationText`.

Specific implementation details for `ragQuery.ts`:
```typescript
// Replace the db.execute part with:
const results = await storage.searchKnowledgeChunks(queryEmbedding, topK);

return results.map(row => ({
  id: row.id,
  docName: row.source.fileName,
  headingPath: row.headingPath,
  content: row.content,
  score: row.similarity || 0
}));